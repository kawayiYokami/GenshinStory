# -*- coding: utf-8 -*-
#
# ==============================================================================
# 占位符和富文本的原始转换规则地图
# ==============================================================================
#
# 本文件定义了所有已知的动态名词和富文本标签的原始正则表达式规则。
# 真正的应用逻辑封装在 text_transformer.py 中。
# 规则的应用顺序至关重要，因此使用列表。

# 使用内部临时占位符，以便转换器进行最终替换
INTERNAL_PLAYER_TAG = '{__PLAYER__}'
INTERNAL_MATE_TAG = '{__MATE__}'

# 正则表达式规则列表 (按顺序执行)
REGEX_RULES = [
    # 注意: 性别相关的 {M#...} 和 {F#...} 由转换器根据参数动态处理, 不在此处定义。
    
    # 规则 1: Ruby 注音格式, 例如 {RUBY#[侯普]希望} -> 希望(侯普)
    (r'\{RUBY#\[(.*?)\](.*?)\}', r'\2(\1)'),
    
    # 规则 2: 将复杂的角色占位符统一为内部标签
    (r'\{PLAYERAVATAR.*?\}', INTERNAL_PLAYER_TAG),
    (r'\{MATEAVATAR.*?\}', INTERNAL_MATE_TAG),
    (r'\{NICKNAME\}', INTERNAL_PLAYER_TAG),
    
    # 规则 3: 移除其他已知的技术性标记
    (r'\{REALNAME.*?\}', ''),

    # 规则 4: 移除富文本标签 (例如 <color...>)
    (r'</?color.*?>', ''),
    
    # Bug 修复: 移除了之前错误的最终清理规则 (r'\{(.*?)\}', r'\1')
    # 它将被移到 text_transformer.py 的最后一步执行。
]