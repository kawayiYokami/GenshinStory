# 文档 3: 面向静态前端的索引生成策略

本文档解释了项目如何生成一系列专门为静态前端站点设计的 JSON 索引文件。这些文件共同为前端应用提供了数据浏览、导航和搜索功能所需的所有元数据。主要涉及的脚本是 `scripts/gi_generate_markdown.py`、`scripts/hsr_generate_markdown.py` 以及 `scripts/gi_generate_catalog_tree.py` 等。

## 核心目标

为前端生成索引的目标是：

1.  **提供完整的条目清单**：创建一个主索引文件，包含站点上所有数据条目（角色、武器、任务等）的元数据，如 ID、名称和访问路径 (URL)。
2.  **构建导航结构**：生成一个独立的、树状的目录结构文件，用于渲染前端的文件浏览器或侧边导航栏。
3.  **支持搜索结果展示**：主索引文件作为搜索结果的“数据库”，将从分片式搜索索引中获取的 ID 列表映射为可供用户点击的详细信息。
4.  **优化加载性能**：将不同功能的索引分离到不同文件中，允许前端按需加载。

## 生成的关键文件及其作用

整个系统主要依赖以下三种为前端生成的 JSON 文件：

### 1. 主索引文件 (`index_gi.json` / `index_hsr.json`)

-   **生成脚本**：`gi_generate_markdown.py` 中的 `export_catalog_index` 函数。
-   **内容**：这是一个包含所有数据条目的**扁平数组**。数组中的每个对象都是一个条目的元数据，通常包括：
    -   `id`: 唯一标识符。
    -   `name`: 条目名称（如“神里绫华”）。
    -   `type`: 条目类型（如“Character”）。
    -   `category`: 所属分类（如“冰”或“圣遗物”）。
    -   `path`: 在前端站点中的绝对访问路径/URL（如 `/v2/gi/category/character/冰/神里绫华-10000046`）。
-   **用途**：
    -   **搜索结果映射**：当分片式搜索引擎返回一个 ID 列表时，前端使用此文件来查找这些 ID 对应的 `name` 和 `path`，从而渲染出完整的搜索结果链接。
    -   **列表页展示**：前端可以直接使用此文件来渲染特定分类下的所有条目列表，例如“所有五星角色”列表。

### 2. 分片式搜索索引 (位于 `search/` 或 `search_hsr/` 目录下)

-   **生成脚本**：`gi_generate_markdown.py` 中的 `export_search_index_chunked` 函数。
-   **内容**：按词条首字母分割的多个 JSON 文件。每个文件包含以该字母开头的词条和拥有这些词条的文档 ID 列表。
-   **用途**：
    -   **高效的离线搜索**：这是搜索引擎的核心。前端根据用户输入动态加载所需的分片文件，在本地进行查询，获取匹配的文档 ID。
    -   详细工作原理请参见《文档 2: 搜索引擎构建流程》。

### 3. 目录树文件 (`catalog_tree_gi.json` / `catalog_tree_hsr.json`)

-   **生成脚本**：`gi_generate_catalog_tree.py`。
-   **内容**：一个嵌套的 JSON 对象，模拟了所有 Markdown 文件生成的物理文件系统的层级结构。
    ```json
    {
      "character": {
        "冰": {
          "神里绫华-10000046.md": null
        },
        "火": { ... }
      },
      "weapon": { ... }
    }
    ```-   **用途**：
    -   **文件导航**：专门用于驱动前端的树状导航组件（类似于 VS Code 的文件浏览器）。用户可以通过这个结构逐级展开目录，最终找到并点击某个具体的文件。
    -   **结构解耦**：将站点的“结构”与“内容元数据”分离。即使未来主索引的结构发生变化，只要目录树的格式不变，导航组件就不需要修改。

## 工作流程协同

这三组文件协同工作，为前端提供了完整的体验：

1.  **启动时**：前端应用加载 `catalog_tree_gi.json` 来构建左侧的导航栏，并加载 `index_gi.json` 到内存中备用。
2.  **用户浏览**：用户点击导航树中的一个文件，前端从该节点的路径信息直接跳转到对应的 Markdown 页面。
3.  **用户搜索**：
    -   用户输入搜索词 "神里"。
    -   前端请求分片文件 `/search/神.json`。
    -   在返回的 JSON 中找到 "神里" 对应的 ID 列表，例如 `[10000046, ...]`。
    -   前端遍历这个 ID 列表，在内存中的 `index_gi.json` 数据里查找 ID 为 `10000046` 的条目。
    -   找到后，提取其 `name` ("神里绫华") 和 `path` ("/v2/gi/category/...")，并将其渲染为一条搜索结果。

## 结论

通过将数据索引分解为**主索引**、**分片式搜索索引**和**目录树索引**，项目为静态前端实现了一套功能完备且高性能的数据驱动方案。这种策略使得纯静态站点也能拥有动态应用般的浏览和搜索体验，同时保持了部署简单、访问速度快的优势。